<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>Bach-machine</title>
	<link href="styles/style.css" rel="stylesheet" type="text/css">
	<script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0"></script>
</head>

<body>

	<div class="content">
		
		<div class="title">
			<h1>Bach-machine</h1>
			<p>Su generador inteligente de corales</p>
		</div>
		
<!-- 		<div class="flex-button-bar">
		
		  <button class="button" onclick="loadHome()">Inicio</button>
		  <button class="button" onclick="loadPrologFile()">Código Prolog</button>
		  <button class="button" onclick="location.href='https://github.com/balath/balath.github.io/raw/master/files/memoria.pdf';">Memoria</button>
		  
		</div> -->
	
		<div id="home-msg" align="center">
			<br>
			  <label for="tonos">Tono del Coral:</label> 
			  <select class="select" id="tonos">
				<option aria-label="do" value="c" selected>Do</option>
				<option aria-label="do sostenido" value="cis">Do♯</option>
				<option aria-label="re bemol" value="des">Re♭</option>
				<option aria-label="re" value="d">Re</option>
				<option aria-label="mi bemol" value="ees">Mi♭</option> 
				<option aria-label="mi" value="e">Mi</option>
				<option aria-label="fa" value="f">Fa</option>
				<option aria-label="fa sostenido" value="fis">Fa♯</option>
				<option aria-label="sol bemol" value="ges">Sol♭</option>
				<option aria-label="sol" value="g">Sol</option>
				<option aria-label="la bemol" value="aes">La♭</option>
				<option aria-label="la" value="a">La</option>
				<option aria-label="si bemol" value="bis">Si♭</option>
				<option aria-label="si" value="b">Si</option>
			  </select>
			  <label for="modo">Modo:</label> 
			  <select class="select" id="modo">
				<option value="major" selected>Mayor</option>
				<option value="minor">Menor</option>
			  </select>
			  <br><br>
			  <input class="select" type="button" value="Generar" onclick="generate()">
			<br>
		</div>
		<div class="flex-content" id="cont"></div>
	</div>
    <script>
        function generate() {
		const host = `https://4fde15ea018b373cb55531f4e2cb4a6e.serveo.net`
            const key = document.getElementById('tonos').value;
            const mode = document.getElementById('modo').value;
            const url = `${host}/choral/${key}/${mode}`;
	    console.log(url);	

            fetch(url)
	    .then(response => {
	    	if (!response.ok) {
	    	throw new Error(`Error: ${response.statusText} (${response.status})`);
                }
                return response.text();
	    })
            .then(text => {
                console.log('Response Text:', text); 
                try {
                    const data = JSON.parse(text); 
                    const pdfId = data.pdf;
                    const midiId = data.midi;

                const pdfUrl = `${host}/pdf/${pdfId}`;
                const midiUrl = `${host}/midi/${midiId}`;

		
		const midiPlayer = `<div class="midi-button">
			    	<midi-player
				  src="${midiUrl}">
				</midi-player>
		                  </div>`;
		const pdfIframe = `<iframe src="${pdfUrl}" class="pdf-iframe"></iframe>`;
		
		document.getElementById('cont').innerHTML = `${midiPlayer}${pdfIframe}`;

		} catch (error) {
                    throw new Error(`Error parsing JSON: ${error.message}`);
                }
            })
            .catch(error => {
		    document.getElementById('cont').innerHTML = `<div><img alt="Bach" src="files/bach.png"></div><div>${error.message}</div>`;
	    });
        }
    </script>
	<br><br>
</body>

<footer>
  <a href="mailto:sergio-flor@outlook.es"><img alt="Mail" src="files/mail32.png"></a>
</footer>

</html>
