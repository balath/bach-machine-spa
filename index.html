<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>Bach-machine</title>
	<link href="styles/style.css" rel="stylesheet" type="text/css">
</head>

<body>

	<div class="content">
		
		<div class="title">
			<h1>Bach-machine</h1>
			<p>Su generador inteligente de corales</p>
		</div>
		
<!-- 		<div class="flex-button-bar">
		
		  <button class="button" onclick="loadHome()">Inicio</button>
		  <button class="button" onclick="loadPrologFile()">Código Prolog</button>
		  <button class="button" onclick="location.href='https://github.com/balath/balath.github.io/raw/master/files/memoria.pdf';">Memoria</button>
		  
		</div> -->
	
		<div id="home-msg" align="center">
			<br>
			<form id="tono" action="prolog.js">
			  <br><br>
			  <label for="tonos">Tono del Coral:</label> 
			  <select class="select" id="tonos">
				<option aria-label="do" value="c" selected>Do</option>
				<option aria-label="do sostenido" value="cis">Do♯</option>
				<option aria-label="re bemol" value="des">Re♭</option>
				<option aria-label="re" value="d">Re</option>
				<option aria-label="mi bemol" value="ees">Mi♭</option> 
				<option aria-label="mi" value="e">Mi</option>
				<option aria-label="fa" value="f">Fa</option>
				<option aria-label="fa sostenido" value="fis">Fa♯</option>
				<option aria-label="sol bemol" value="ges">Sol♭</option>
				<option aria-label="sol" value="g">Sol</option>
				<option aria-label="la bemol" value="aes">La♭</option>
				<option aria-label="la" value="a">La</option>
				<option aria-label="si bemol" value="bis">Si♭</option>
				<option aria-label="si" value="b">Si</option>
			  </select>
			  <br><br>
			  <label for="modo">Modo:</label> 
			  <select class="select" id="modo">
				<option value="major" selected>Mayor</option>
				<option value="minor">Menor</option>
			  </select>
			  <br><br>
			  <input class="select" type="button" value="Generar" onclick="generate()">
			</form>
			<br>
		</div>
		<div class="flex-content" id="cont"></div>
	</div>

	<script src="scripts/tau-prolog.js"></script>
	<script src="scripts/prologString.js"></script>
	<script src="scripts/main.js"></script>
    <script>
        function generate() {
		const host = `https://4fde15ea018b373cb55531f4e2cb4a6e.serveo.net`
            const key = document.getElementById('tonos').value;
            const mode = document.getElementById('modo').value;
            const url = `${host}/choral/${key}/${mode}`;
	    console.log(url);	

            fetch(url)
	    .then(response => {
	    	if (!response.ok) {
	    	throw new Error(`Error: ${response.statusText} (${response.status})`);
                }
                return response.text();
	    })
            .then(text => {
                console.log('Response Text:', text); // Imprime la respuesta en texto
                try {
                    const data = JSON.parse(text); // Intenta parsear el JSON
                    const pdfId = data.pdf;
                    const midiId = data.midi;

                // Construir URLs
                const pdfUrl = `${host}/pdf/${pdfId}`;
                const midiUrl = `${host}/midi/${midiId}`;

		// Crear elementos para descargar el MIDI y mostrar el PDF
		const midiPlayer = `<div class="midi-player" style="margin-bottom: 20px; text-align: center;">
		                      <audio controls>
		                        <source src="${midiUrl}" type="audio/midi">
		                        Tu navegador no soporta la reproducción de archivos MIDI.
		                      </audio>
		                    </div>`;
		// const midiLink = `<div class="midi-button">
		//                     <a href="${midiUrl}" download="choral.mid" style="padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px;">Descargar archivo MIDI</a>
		//                   </div>`;
		const pdfIframe = `<iframe src="${pdfUrl}" class="pdf-iframe" style="width: 100%; max-width: 1000px; height: 80vh; border: none;"></iframe>`;

		// Mostrar resultados en el contenedor
		document.getElementById('cont').innerHTML = `${midiPlayer}${pdfIframe}`;


		} catch (error) {
                    throw new Error(`Error parsing JSON: ${error.message}`);
                }
            })
            .catch(error => {
		    document.getElementById('cont').innerHTML = `<div style="color: red;">${error.message}</div>`;
	    });
        }
    </script>
	<br><br>
</body>

<footer>
  <a href="mailto:sergio-flor@outlook.es"><img alt="Mail" src="files/mail32.png"></a>
  <a href="http://tau-prolog.org/"><img alt="Tau-Prolog website" src="files/tauprolog32.png"></a>
  <a href="https://twitter.com/balath83"><img alt="Twitter" src="files/twitter32.png"></a>  
</footer>

</html>
